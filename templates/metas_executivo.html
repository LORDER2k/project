{% extends "base_executivo.html" %}

{% block title %}Metas - ContaSmart Pro{% endblock %}
{% block page_title %}Metas Financeiras{% endblock %}
{% block page_subtitle %}Defina e acompanhe seus objetivos{% endblock %}

{% block breadcrumb %}
<li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
<li><a href="{{ url_for('goals') }}">{{ 'Metas' }}</a></li>
{% endblock %}

{% block extra_css %}
<style>
    .goals-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-xl);
        flex-wrap: wrap;
        gap: var(--spacing-md);
    }
    
    .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
    }
    
    .stat-card-goal {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        padding: var(--spacing-lg);
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .stat-card-goal::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
    }
    
    .stat-card-goal.active::before {
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    }
    
    .stat-card-goal.completed::before {
        background: linear-gradient(90deg, var(--success-color), #00cc77);
    }
    
    .stat-card-goal.overdue::before {
        background: linear-gradient(90deg, var(--danger-color), #ff0066);
    }
    
    .stat-card-goal.total::before {
        background: linear-gradient(90deg, var(--warning-color), #ffaa00);
    }
    
    .stat-icon-goal {
        width: 50px;
        height: 50px;
        margin: 0 auto var(--spacing-md);
        border-radius: var(--border-radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }
    
    .stat-card-goal.active .stat-icon-goal {
        background: rgba(0, 102, 255, 0.1);
        color: var(--primary-color);
    }
    
    .stat-card-goal.completed .stat-icon-goal {
        background: rgba(0, 255, 136, 0.1);
        color: var(--success-color);
    }
    
    .stat-card-goal.overdue .stat-icon-goal {
        background: rgba(255, 51, 102, 0.1);
        color: var(--danger-color);
    }
    
    .stat-card-goal.total .stat-icon-goal {
        background: rgba(255, 153, 0, 0.1);
        color: var(--warning-color);
    }
    
    .stat-value-goal {
        font-size: 1.8rem;
        font-weight: 800;
        margin-bottom: var(--spacing-xs);
        font-family: var(--font-mono);
    }
    
    .stat-label-goal {
        font-size: 0.9rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .goals-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
    }
    
    .goal-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        padding: var(--spacing-lg);
        transition: all var(--transition-fast);
        position: relative;
        overflow: hidden;
    }
    
    .goal-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
    }
    
    .goal-card.completed {
        opacity: 0.8;
    }
    
    .goal-card.overdue {
        border-left: 4px solid var(--danger-color);
    }
    
    .goal-card.urgent {
        border-left: 4px solid var(--warning-color);
    }
    
    .goal-card.ontrack {
        border-left: 4px solid var(--success-color);
    }
    
    .goal-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-md);
    }
    
    .goal-title {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: var(--spacing-xs);
        flex: 1;
    }
    
    .goal-priority {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-left: var(--spacing-sm);
    }
    
    .priority-high {
        background: rgba(255, 51, 102, 0.1);
        color: var(--danger-color);
        border: 1px solid rgba(255, 51, 102, 0.3);
    }
    
    .priority-medium {
        background: rgba(255, 153, 0, 0.1);
        color: var(--warning-color);
        border: 1px solid rgba(255, 153, 0, 0.3);
    }
    
    .priority-low {
        background: rgba(0, 204, 255, 0.1);
        color: var(--info-color);
        border: 1px solid rgba(0, 204, 255, 0.3);
    }
    
    .goal-description {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: var(--spacing-lg);
        line-height: 1.5;
    }
    
    .goal-progress {
        margin-bottom: var(--spacing-lg);
    }
    
    .progress-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--spacing-xs);
        font-size: 0.9rem;
    }
    
    .progress-amount {
        font-family: var(--font-mono);
        font-weight: 600;
    }
    
    .progress-percentage {
        color: var(--text-muted);
        font-family: var(--font-mono);
    }
    
    .progress-bar-goal {
        height: 8px;
        background: var(--bg-tertiary);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: var(--primary-color);
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    
    .progress-fill.completed {
        background: var(--success-color);
    }
    
    .progress-fill.overdue {
        background: var(--danger-color);
    }
    
    .goal-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: var(--spacing-lg);
        padding-top: var(--spacing-md);
        border-top: 1px solid var(--border-color);
    }
    
    .goal-deadline {
        font-size: 0.85rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
    }
    
    .goal-actions {
        display: flex;
        gap: var(--spacing-xs);
    }
    
    .goal-action-btn {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--border-radius-sm);
        color: var(--text-secondary);
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        transition: all var(--transition-fast);
    }
    
    .goal-action-btn:hover {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    
    .goal-action-btn.add:hover {
        background: var(--success-color);
        border-color: var(--success-color);
    }
    
    .goal-action-btn.edit:hover {
        background: var(--warning-color);
        border-color: var(--warning-color);
    }
    
    .goal-action-btn.delete:hover {
        background: var(--danger-color);
        border-color: var(--danger-color);
    }
    
    .no-goals {
        text-align: center;
        padding: var(--spacing-xxl);
        color: var(--text-muted);
        grid-column: 1 / -1;
    }
    
    .no-goals i {
        font-size: 4rem;
        margin-bottom: var(--spacing-lg);
        opacity: 0.3;
    }
    
    .goal-status-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-top: var(--spacing-xs);
    }
    
    .status-active {
        background: rgba(0, 102, 255, 0.1);
        color: var(--primary-color);
        border: 1px solid rgba(0, 102, 255, 0.3);
    }
    
    .status-completed {
        background: rgba(0, 255, 136, 0.1);
        color: var(--success-color);
        border: 1px solid rgba(0, 255, 136, 0.3);
    }
    
    .goals-filters {
        display: flex;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-xl);
        flex-wrap: wrap;
    }
    
    .filter-btn {
        padding: 8px 16px;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-md);
        color: var(--text-secondary);
        font-size: 0.9rem;
        transition: all var(--transition-fast);
    }
    
    .filter-btn:hover {
        background: var(--bg-card);
        color: var(--text-primary);
    }
    
    .filter-btn.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    
    @media (max-width: 768px) {
        .goals-grid {
            grid-template-columns: 1fr;
        }
        
        .stats-overview {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .goals-header {
            flex-direction: column;
            align-items: stretch;
        }
    }
    
    @media (max-width: 576px) {
        .stats-overview {
            grid-template-columns: 1fr;
        }
        
        .goal-header {
            flex-direction: column;
            gap: var(--spacing-sm);
        }
        
        .goal-priority {
            align-self: flex-start;
        }
        
        .goal-footer {
            flex-direction: column;
            gap: var(--spacing-md);
            align-items: stretch;
        }
        
        .goal-actions {
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="goals-header">
    <div>
        <h1 style="font-size: 1.8rem; margin-bottom: var(--spacing-xs);">Metas Financeiras</h1>
        <p style="color: var(--text-muted);">Defina objetivos e acompanhe seu progresso</p>
    </div>
    
    <button class="neon-btn primary" onclick="showAddGoalModal()">
        <i class="fas fa-plus"></i> Nova Meta
    </button>
</div>

<!-- Estatísticas -->
<div class="stats-overview">
    {% set active_goals = goals|selectattr('is_completed', 'equalto', false)|list|length %}
    {% set completed_goals = goals|selectattr('is_completed', 'equalto', true)|list|length %}
    {% set total_value = goals|sum(attribute='target_amount') %}
    {% set current_value = goals|sum(attribute='current_amount') %}
    
    <div class="stat-card-goal active">
        <div class="stat-icon-goal">
            <i class="fas fa-bullseye"></i>
        </div>
        <div class="stat-value-goal">{{ active_goals }}</div>
        <div class="stat-label-goal">Metas Ativas</div>
    </div>
    
    <div class="stat-card-goal completed">
        <div class="stat-icon-goal">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-value-goal">{{ completed_goals }}</div>
        <div class="stat-label-goal">Concluídas</div>
    </div>
    
    <div class="stat-card-goal total">
        <div class="stat-icon-goal">
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-value-goal">{{ format_currency(total_value) }}</div>
        <div class="stat-label-goal">Valor Total</div>
    </div>
    
    <div class="stat-card-goal">
        <div class="stat-icon-goal" style="background: rgba(0, 204, 255, 0.1); color: var(--info-color);">
            <i class="fas fa-percentage"></i>
        </div>
        <div class="stat-value-goal">
            {% if total_value > 0 %}
            {{ ((current_value / total_value) * 100)|round(1) }}%
            {% else %}
            0%
            {% endif %}
        </div>
        <div class="stat-label-goal">Progresso Total</div>
    </div>
</div>

<!-- Filtros -->
<div class="goals-filters">
    <button class="filter-btn active" onclick="filterGoals('all')">
        Todas ({{ goals|length }})
    </button>
    <button class="filter-btn" onclick="filterGoals('active')">
        Ativas ({{ active_goals }})
    </button>
    <button class="filter-btn" onclick="filterGoals('completed')">
        Concluídas ({{ completed_goals }})
    </button>
    <button class="filter-btn" onclick="filterGoals('high')">
        Alta Prioridade
    </button>
    <button class="filter-btn" onclick="filterGoals('overdue')">
        Atrasadas
    </button>
</div>

<!-- Grid de Metas -->
<div class="goals-grid" id="goalsGrid">
    {% if goals %}
        {% for goal in goals %}
            {% set progress = (goal.current_amount / goal.target_amount * 100) if goal.target_amount > 0 else 0 %}
            {% set is_overdue = goal.deadline and goal.deadline < now.strftime('%Y-%m-%d') and not goal.is_completed %}
            {% set is_urgent = goal.deadline and (goal.deadline|string).split('-')[2]|int - now.strftime('%d')|int <= 7 and not goal.is_completed %}
            
            <div class="goal-card {{ 'completed' if goal.is_completed else '' }} {{ 'overdue' if is_overdue else 'urgent' if is_urgent else 'ontrack' }}"
                 data-status="{{ 'completed' if goal.is_completed else 'active' }}"
                 data-priority="{{ goal.priority or 'medium' }}"
                 data-overdue="{{ 'true' if is_overdue else 'false' }}">
                
                <div class="goal-header">
                    <div>
                        <h3 class="goal-title">{{ goal.title }}</h3>
                        <div class="goal-status-badge status-{{ 'completed' if goal.is_completed else 'active' }}">
                            <i class="fas fa-{{ 'check-circle' if goal.is_completed else 'clock' }}"></i>
                            {{ 'Concluída' if goal.is_completed else 'Em Andamento' }}
                        </div>
                    </div>
                    
                    {% if goal.priority %}
                    <span class="goal-priority priority-{{ goal.priority }}">
                        {{ goal.priority|title }}
                    </span>
                    {% endif %}
                </div>
                
                {% if goal.description %}
                <p class="goal-description">{{ goal.description }}</p>
                {% endif %}
                
                <div class="goal-progress">
                    <div class="progress-info">
                        <span class="progress-amount">
                            {{ format_currency(goal.current_amount) }} de {{ format_currency(goal.target_amount) }}
                        </span>
                        <span class="progress-percentage">
                            {{ progress|round(1) }}%
                        </span>
                    </div>
                    
                    <div class="progress-bar-goal">
                        <div class="progress-fill {{ 'completed' if goal.is_completed else 'overdue' if is_overdue else '' }}" 
                             style="width: {{ progress }}%"></div>
                    </div>
                </div>
                
                <div class="goal-footer">
                    <div class="goal-deadline">
                        {% if goal.deadline %}
                        <i class="fas fa-calendar-alt"></i>
                        <span>
                            {% if is_overdue %}
                            <strong style="color: var(--danger-color);">Vencida: {{ goal.deadline }}</strong>
                            {% elif is_urgent %}
                            <strong style="color: var(--warning-color);">Vence: {{ goal.deadline }}</strong>
                            {% else %}
                            Vence: {{ goal.deadline }}
                            {% endif %}
                        </span>
                        {% else %}
                        <i class="fas fa-infinity"></i>
                        <span>Sem prazo definido</span>
                        {% endif %}
                    </div>
                    
                    <div class="goal-actions">
                        {% if not goal.is_completed %}
                        <button class="goal-action-btn add" onclick="addToGoal({{ goal.id }})" title="Adicionar Valor">
                            <i class="fas fa-plus"></i>
                        </button>
                        {% endif %}
                        
                        <button class="goal-action-btn edit" onclick="editGoal({{ goal.id }})" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        
                        <button class="goal-action-btn delete" onclick="deleteGoal({{ goal.id }})" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
    <div class="no-goals">
        <i class="fas fa-bullseye"></i>
        <h3 style="margin-bottom: var(--spacing-md);">Nenhuma meta definida</h3>
        <p style="color: var(--text-muted); margin-bottom: var(--spacing-xl);">
            Crie sua primeira meta financeira para começar a acompanhar seus objetivos.
        </p>
        <button class="neon-btn primary lg" onclick="showAddGoalModal()">
            <i class="fas fa-plus"></i> Criar Primeira Meta
        </button>
    </div>
    {% endif %}
</div>

<!-- Dicas -->
<div style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--border-radius-lg); padding: var(--spacing-lg); margin-top: var(--spacing-xl);">
    <h3 style="margin-bottom: var(--spacing-md); display: flex; align-items: center; gap: var(--spacing-sm);">
        <i class="fas fa-lightbulb" style="color: var(--warning-color);"></i>
        Dicas para suas metas
    </h3>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg);">
        <div>
            <h4 style="font-size: 0.95rem; margin-bottom: var(--spacing-xs); color: var(--primary-color);">
                <i class="fas fa-target"></i> Seja Específico
            </h4>
            <p style="font-size: 0.9rem; color: var(--text-muted);">
                Defina metas claras e mensuráveis. Ex: "Economizar R$ 5.000 para viagem" ao invés de "Economizar dinheiro".
            </p>
        </div>
        
        <div>
            <h4 style="font-size: 0.95rem; margin-bottom: var(--spacing-xs); color: var(--primary-color);">
                <i class="fas fa-calendar-check"></i> Defina Prazos
            </h4>
            <p style="font-size: 0.9rem; color: var(--text-muted);">
                Metas com prazos definidos têm 42% mais chance de serem alcançadas.
            </p>
        </div>
        
        <div>
            <h4 style="font-size: 0.95rem; margin-bottom: var(--spacing-xs); color: var(--primary-color);">
                <i class="fas fa-chart-pie"></i> Divida em Partes
            </h4>
            <p style="font-size: 0.9rem; color: var(--text-muted);">
                Grandes metas podem ser divididas em metas menores e mais gerenciáveis.
            </p>
        </div>
    </div>
</div>

<!-- Modal para Nova Meta -->
<div id="addGoalModal" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3><i class="fas fa-plus-circle"></i> Nova Meta Financeira</h3>
            <button class="modal-close" onclick="closeModal('addGoalModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="goalForm">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">
                        <i class="fas fa-heading me-2"></i>Título da Meta *
                    </label>
                    <input type="text" 
                           name="title" 
                           required 
                           placeholder="ex: Economizar para viagem"
                           style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); color: var(--text-primary);">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">
                        <i class="fas fa-align-left me-2"></i>Descrição
                    </label>
                    <textarea name="description" 
                              rows="3"
                              placeholder="Descreva sua meta com mais detalhes..."
                              style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); color: var(--text-primary); resize: vertical;"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">
                            <i class="fas fa-bullseye me-2"></i>Valor Alvo *
                        </label>
                        <input type="number" 
                               name="target_amount" 
                               step="0.01" 
                               min="0.01" 
                               required 
                               placeholder="0.00"
                               style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); color: var(--text-primary);">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">
                            <i class="fas fa-wallet me-2"></i>Valor Atual
                        </label>
                        <input type="number" 
                               name="current_amount" 
                               step="0.01" 
                               min="0" 
                               value="0"
                               placeholder="0.00"
                               style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); color: var(--text-primary);">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">
                            <i class="fas fa-calendar-alt me-2"></i>Data Limite
                        </label>
                        <input type="date" 
                               name="deadline"
                               style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); color: var(--text-primary);">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">
                            <i class="fas fa-flag me-2"></i>Prioridade
                        </label>
                        <select name="priority" 
                                style="width: 100%; padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); color: var(--text-primary);">
                            <option value="medium">Média</option>
                            <option value="high">Alta</option>
                            <option value="low">Baixa</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="neon-btn outline" onclick="closeModal('addGoalModal')">
                Cancelar
            </button>
            <button class="neon-btn primary" onclick="submitGoal()">
                <i class="fas fa-save"></i> Salvar Meta
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Configurar data mínima para hoje no formulário
        const deadlineInput = document.querySelector('input[name="deadline"]');
        if (deadlineInput) {
            const today = new Date().toISOString().split('T')[0];
            deadlineInput.min = today;
        }
    });
    
    function filterGoals(filter) {
        const buttons = document.querySelectorAll('.filter-btn');
        const goals = document.querySelectorAll('.goal-card');
        
        // Atualizar botões ativos
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // Filtrar metas
        goals.forEach(goal => {
            let show = true;
            
            switch(filter) {
                case 'active':
                    show = goal.getAttribute('data-status') === 'active';
                    break;
                case 'completed':
                    show = goal.getAttribute('data-status') === 'completed';
                    break;
                case 'high':
                    show = goal.getAttribute('data-priority') === 'high';
                    break;
                case 'overdue':
                    show = goal.getAttribute('data-overdue') === 'true';
                    break;
                // 'all' mostra todas
            }
            
            goal.style.display = show ? '' : 'none';
        });
        
        // Mostrar mensagem se não houver resultados
        const visibleGoals = document.querySelectorAll('.goal-card[style*="display: none"]');
        if (visibleGoals.length === goals.length && goals.length > 0) {
            showNoResultsMessage(filter);
        }
    }
    
    function showNoResultsMessage(filter) {
        const message = `Nenhuma meta encontrada com o filtro "${filter}".`;
        showToast(message, 'info');
    }
    
    function showAddGoalModal() {
        document.getElementById('addGoalModal').style.display = 'flex';
        
        // Preencher data padrão (30 dias a partir de hoje)
        const deadlineInput = document.querySelector('input[name="deadline"]');
        if (deadlineInput) {
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 30);
            deadlineInput.value = futureDate.toISOString().split('T')[0];
        }
    }
    
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }
    
    function submitGoal() {
        const form = document.getElementById('goalForm');
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        // Validar
        if (!data.title || !data.target_amount || parseFloat(data.target_amount) <= 0) {
            showToast('Preencha todos os campos obrigatórios com valores válidos.', 'danger');
            return;
        }
        
        // Aqui você faria a requisição para salvar a meta
        // fetch('/api/add_goal', { method: 'POST', body: JSON.stringify(data) })
        
        showToast('Meta criada com sucesso!', 'success');
        closeModal('addGoalModal');
        
        // Recarregar a página após um momento
        setTimeout(() => {
            window.location.reload();
        }, 1500);
    }
    
    function addToGoal(goalId) {
        const amount = prompt('Quanto deseja adicionar para esta meta?');
        
        if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
            // Aqui você faria a requisição para atualizar a meta
            showToast(`R$ ${parseFloat(amount).toFixed(2)} adicionados à meta!`, 'success');
            
            // Simular atualização
            setTimeout(() => {
                // Em uma implementação real, você atualizaria a interface com os novos dados
                window.location.reload();
            }, 1000);
        } else if (amount !== null) {
            showToast('Por favor, insira um valor válido.', 'danger');
        }
    }
    
    function editGoal(goalId) {
        // Aqui você carregaria os dados da meta e mostraria o modal de edição
        showToast('Funcionalidade de edição em desenvolvimento!', 'info');
    }
    
    function deleteGoal(goalId) {
        if (confirm('Tem certeza que deseja excluir esta meta?\nEsta ação não pode ser desfeita.')) {
            // Aqui você faria a requisição para deletar a meta
            showToast('Meta excluída com sucesso!', 'success');
            
            // Simular exclusão
            setTimeout(() => {
                const card = document.querySelector(`[onclick="deleteGoal(${goalId})"]`).closest('.goal-card');
                if (card) {
                    card.style.opacity = '0';
                    setTimeout(() => card.remove(), 300);
                    updateGoalStats();
                }
            }, 1000);
        }
    }
    
    function updateGoalStats() {
        // Atualizar estatísticas após exclusão
        const remainingGoals = document.querySelectorAll('.goal-card:not([style*="opacity: 0"])');
        const activeGoals = Array.from(remainingGoals).filter(card => 
            card.getAttribute('data-status') === 'active'
        ).length;
        
        const completedGoals = Array.from(remainingGoals).filter(card => 
            card.getAttribute('data-status') === 'completed'
        ).length;
        
        // Atualizar contadores (em uma implementação real)
        console.log(`Metas ativas: ${activeGoals}, Concluídas: ${completedGoals}`);
    }
    
    function showToast(message, type) {
        const toast = document.createElement('div');
        toast.className = `flash-message flash-${type}`;
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 300px;
            animation: slideInRight 0.3s ease;
        `;
        
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-circle' : type === 'danger' ? 'times-circle' : 'info-circle'}"></i>
            ${message}
            <button class="flash-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
        `;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 300);
        }, 5000);
    }
</script>
{% endblock %}